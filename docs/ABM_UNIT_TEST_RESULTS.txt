
--- SECTION 1: INITIALIZATION TESTS ---


--- SECTION 2: STEP FUNCTION TESTS ---


--- SECTION 3: STUDENT BEHAVIOR TESTS ---


--- SECTION 4: MERCHANT BEHAVIOR TESTS ---


--- SECTION 5: CONSCRIPT DEFECTION TESTS ---


--- SECTION 6: HARDLINER BEHAVIOR TESTS ---


--- SECTION 7: EXHAUSTION TESTS ---


--- SECTION 8: RESET AND MONTE CARLO TESTS ---


--- SECTION 9: GET_SNAPSHOT TESTS ---


--- SECTION 10: NETWORK TESTS ---


--- SECTION 11: INTERNET BLACKOUT TESTS ---


======================================================================
ABM ENGINE UNIT TEST REPORT
======================================================================

PASSED: 38
  [PASS] 1.1 Agent type distribution
         student=1500, merchant=2000, conscript=1000, hardliner=500, civilian=5000
  [PASS] 1.2 Agent types shuffled (uniform distribution)
         First 2 agents have same type
  [PASS] 1.3.0 student grievance (Beta(4,2))
         mean=0.670, expected [0.60, 0.75]
  [PASS] 1.3.1 merchant grievance (Beta(3,3))
         mean=0.500, expected [0.45, 0.55]
  [PASS] 1.3.4 civilian grievance (Beta(2,3))
         mean=0.399, expected [0.35, 0.45]
  [PASS] 1.3.2 conscript grievance (Beta(1,4))
         mean=0.197, expected [0.15, 0.25]
  [PASS] 1.3.3 hardliner grievance (Fixed 0.0)
         mean=0.000, expected [-0.01, 0.01]
  [PASS] 1.4 Base threshold in range [0.3, 0.8]
         min=0.300, max=0.800
  [PASS] 1.5 Initial state arrays zeroed
  [PASS] 1.6 Network built with neighbors
         avg_neighbors=16.0
  [PASS] 2.1 Step returns all required keys
         keys=['total_protesting', 'defection_rate', 'coordination_score', 'student_participation', 'merchant_participation', 'civilian_participation', 'hardliner_defection', 'avg_grievance', 'avg_threshold', 'n_active', 'n_defected', 'new_activations', 'deactivations', 'regional_breakdown']
  [PASS] 2.2 Security forces never protest
         security_active=0
  [PASS] 2.3 Grievance bounded [0, 1]
         min=0.000, max=1.000
  [PASS] 2.4 Days active increments for active
  [PASS] 2.5 Days active resets for inactive
  [PASS] 3.1 Students more active when ESCALATING
         stable=65.3%, escalating=88.7%
  [PASS] 4.1 Merchant grievance increases with high Rial
         initial=0.491, final=1.000
  [PASS] 4.2 Merchant grievance reduces on concessions
         pre=1.000, post=0.500
  [PASS] 4.3 Graduated economic scale (monotonic)
         grievances=['1.0M:0.49', '1.2M:0.57', '1.5M:0.64', '1.8M:0.71', '2.0M:0.78']
  [PASS] 5.1 Low defection without crackdown
         defection_rate=0.0%
  [PASS] 5.2 Defection with high crackdown + overwhelmed
         defection_rate=65.0%
  [PASS] 5.3 Defection contagion threshold = 0.4 (Gemini V2)
         threshold=0.4
  [PASS] 5.4 Hardliner fear bonus reduces defection
         near_hardliner=36.9%, far=78.0%
  [PASS] 6.1 Hardliner grievance stays at 0
         grievance=0.0
  [PASS] 6.2 Hardliners defect on mass conscript defection
         conscript_def=65.0%, hardliner_def=100.0%
  [PASS] 6.3 Hardliner suppression reduces neighbor activation
         near_hardliner=16.6%, far=27.7%
  [PASS] 7.1 Agents become exhausted after 7 days
         n_exhausted=388
  [PASS] 7.3 Exhaustion applied in Phase 1 (before activation)
         Verified by code inspection
  [PASS] 8.1 Reset clears state arrays
         pre_active=518, pre_defected=46
  [PASS] 8.2 Reset re-randomizes grievance
  [PASS] 8.3 Multiple runs produce variance
         variance=0.0015, outcomes=['66.0%', '68.0%', '67.0%', '67.0%', '67.0%', '67.0%', '68.0%', '67.0%', '79.0%', '64.0%']
  [PASS] 9.1 Snapshot contains full arrays
  [PASS] 9.2 Snapshot contains grievance histogram
  [PASS] 9.3 Snapshot contains per-type breakdown
  [PASS] 9.4 Snapshot arrays are copies
  [PASS] 10.2 Network is symmetric (undirected)
  [PASS] 10.3 No self-loops
  [PASS] 11.1 Internet blackout reduces active agents
         no_blackout=531, blackout=396

FAILED: 2
  [FAIL] 7.2 Exhausted agents have lower grievance
         exhausted=0.441, non-exhausted=0.284
  [FAIL] 10.1 Small-world network avg neighbors ~8
         avg_neighbors=16.0

======================================================================
TOTAL: 38/40 tests passed (95.0%)
======================================================================

